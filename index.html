<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALDISAN - Reporte de Tarimas</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0b1220;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #3b82f6;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #3b82f6;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #1e293b;
    }
    .form-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: none;
      background: #1e293b;
      color: #fff;
    }
    .firmas {
      display: flex;
      justify-content: space-between;
      margin-top: 40px;
    }
    .firma-box {
      text-align: center;
      flex: 1;
    }
    .firma-line {
      height: 1px;
      background: #3b82f6;
      margin: 40px 20px 10px;
    }
    .botones {
      margin: 20px 0;
      text-align: center;
    }
    .botones button {
      margin: 0 10px;
      padding: 10px 20px;
      background: #3b82f6;
      border: none;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ALDISAN – Reporte de Carga de Tarimas</h1>  <div class="form-section">
    <div>
      <label for="operador">Operador</label>
      <input type="text" id="operador" />
    </div>
    <div>
      <label for="placas">Placas</label>
      <input type="text" id="placas" />
    </div>
    <div>
      <label for="tipoUnidad">Tipo de Unidad</label>
      <input type="text" id="tipoUnidad" />
    </div>
    <div>
      <label for="transportista">Transportista</label>
      <input type="text" id="transportista" />
    </div>
    <div>
      <label for="documento">Factura / Remisión</label>
      <input type="text" id="documento" />
    </div>
  </div>  <table id="tabla">
    <thead>
      <tr>
        <th>Código</th>
        <th>Descripción</th>
        <th>Lote</th>
        <th>Caducidad</th>
        <th>Cajas</th>
        <th>Pz/Caja</th>
        <th>Pz Total</th>
      </tr>
    </thead>
    <tbody>
      <tr class="empty-row">
        <td colspan="7">Sin productos aún</td>
      </tr>
    </tbody>
  </table>  <div class="firmas">
    <div class="firma-box">
      <div class="firma-line"></div>
      <div id="firmaOperador"></div>
    </div>
    <div class="firma-box">
      <div class="firma-line"></div>
      <div>VÍCTOR GONZÁLES</div>
    </div>
  </div>  <div class="botones">
    <button onclick="exportarExcel()">Exportar Excel</button>
    <button onclick="window.print()">Imprimir</button>
  </div>  <script>
    let itemCount = 0;
    let totalPieces = 0;
    let codigosEscaneados = new Set();
    let registrosExcel = [];

    function exportarExcel() {
      const operador = document.getElementById('operador').value;
      const placas = document.getElementById('placas').value;
      const tipoUnidad = document.getElementById('tipoUnidad').value;
      const documento = document.getElementById('documento').value;
      const transportista = document.getElementById('transportista').value;

      const datosCabecera = [
        { Dato: 'Operador', Valor: operador },
        { Dato: 'Placas', Valor: placas },
        { Dato: 'Tipo de Unidad', Valor: tipoUnidad },
        { Dato: 'Factura/Remisión', Valor: documento },
        { Dato: 'Transportista', Valor: transportista },
        {},
      ];

      const wb = XLSX.utils.book_new();
      const cabecera = XLSX.utils.json_to_sheet(datosCabecera);
      const productos = XLSX.utils.json_to_sheet(registrosExcel, { origin: -1 });
      XLSX.utils.book_append_sheet(wb, cabecera, "Reporte");
      XLSX.writeFile(wb, "reporte_tarimas.xlsx");
    }

    function procesarCodigoQR(codigo) {
      const partes = codigo.trim().split(/\t|\s{2,}/);
      if (partes.length < 9) {
        alert("Código QR no válido");
        return;
      }

      const [operadorQR, folio, codigoId, descripcion, lote, caducidad, pzCaja, cajas, totalPiezasQR] = partes;
      const totalPz = parseInt(pzCaja) * parseInt(cajas);
      totalPieces += totalPz;
      itemCount++;

      document.getElementById('firmaOperador').innerText = operadorQR;

      const tbody = document.querySelector('#tabla tbody');
      const emptyRow = document.querySelector('.empty-row');
      if (emptyRow) emptyRow.remove();

      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td>${codigoId}</td>
        <td>${descripcion}</td>
        <td>${lote}</td>
        <td>${caducidad}</td>
        <td>${cajas}</td>
        <td>${pzCaja}</td>
        <td>${totalPz}</td>`;

      tbody.appendChild(newRow);

      registrosExcel.push({
        operador: operadorQR,
        folio,
        codigo: codigoId,
        descripcion,
        lote,
        caducidad,
        pzCaja: parseInt(pzCaja),
        cajas: parseInt(cajas),
        totalPiezas: totalPz
      });
    }
  </script></body>
</html>