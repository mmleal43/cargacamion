<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ALDISAN-KSK REPORTE DE EMBARQUE</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #0b0f1a;
      color: white;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #00ccff;
    }
    img.logo {
      display: block;
      margin: 0 auto 10px auto;
      width: 180px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    button {
      background-color: #00ccff;
      color: #000;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #fff;
      color: #000;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .firmas {
      margin-top: 40px;
      display: flex;
      justify-content: space-around;
    }
    .firma {
      text-align: center;
    }
    .form-section, .botones {
      max-width: 500px;
      margin: 0 auto;
    }
    .botones {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
    }
    .print-area {
      background-color: white;
      color: black;
      padding: 20px;
    }
    .info-formulario {
      text-align: left;
      margin-top: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <img class="logo" src="data:image/png;base64,REEMPLAZAR_BASE64_LOGO" alt="Logo Aldisan" />
  <h1>ALDISAN – Reporte de Carga de Tarimas</h1>  <div class="form-section">
    <input type="text" id="operador" placeholder="Nombre del operador" required>
    <input type="text" id="placas" placeholder="Placas" required>
    <select id="unidad" required>
      <option value="">Selecciona tipo de unidad</option>
      <option value="Camioneta">Camioneta</option>
      <option value="Torton">Torton</option>
      <option value="Tráiler">Tráiler</option>
    </select>
    <input type="text" id="transportista" placeholder="Transportista" required>
    <input type="text" id="factura" placeholder="Factura/Remisión" required>
    <button onclick="escanearQR()">Escanear QR</button>
  </div>  <div class="botones">
    <button onclick="exportarExcel()">Exportar Excel</button>
    <button onclick="imprimir()">Imprimir</button>
  </div>  <div id="reporte" class="print-area">
    <div class="info-formulario" id="infoFormulario"></div>
    <table id="tabla">
      <thead>
        <tr>
          <th>Código</th><th>Descripción</th><th>Lote</th><th>Caducidad</th><th>Cajas</th><th>Pz/Caja</th><th>Pz Total</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="firmas">
      <div class="firma">
        <div id="nombreOperador">_____________________</div>
        <small>Operador</small>
      </div>
      <div class="firma">
        _____________________<br>
        <small>VÍCTOR GONZÁLES</small>
      </div>
    </div>
  </div>  <script>
    const productos = [];
    const uidsEscaneados = new Set();

    function escanearQR() {
      const datosQR = prompt("Simula aquí el escaneo del QR:");
      if (!datosQR) return;
      const [operadorUID, uid, codigo, descripcion, lote, caducidad, cajas, pzxcaja, total] = datosQR.split('\t');
      if (uidsEscaneados.has(uid)) {
        alert("Este código ya fue escaneado");
        return;
      }
      uidsEscaneados.add(uid);
      productos.push({ codigo, descripcion, lote, caducidad, cajas, pzxcaja, total });
      actualizarTabla();
    }

    function actualizarTabla() {
      const cuerpo = document.querySelector("#tabla tbody");
      cuerpo.innerHTML = productos.length === 0
        ? '<tr><td colspan="7">Sin productos aún</td></tr>'
        : productos.map(p =>
            `<tr><td>${p.codigo}</td><td>${p.descripcion}</td><td>${p.lote}</td><td>${p.caducidad}</td><td>${p.cajas}</td><td>${p.pzxcaja}</td><td>${p.total}</td></tr>`
          ).join('');
    }

    function exportarExcel() {
      const data = [
        ["Operador", "Placas", "Unidad", "Transportista", "Factura/Remisión"],
        [
          document.getElementById("operador").value,
          document.getElementById("placas").value,
          document.getElementById("unidad").value,
          document.getElementById("transportista").value,
          document.getElementById("factura").value
        ],
        [],
        ["Código", "Descripción", "Lote", "Caducidad", "Cajas", "Pz/Caja", "Pz Total"],
        ...productos.map(p => [p.codigo, p.descripcion, p.lote, p.caducidad, p.cajas, p.pzxcaja, p.total])
      ];
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(data);
      XLSX.utils.book_append_sheet(wb, ws, "Reporte");
      XLSX.writeFile(wb, "reporte_embarque.xlsx");
    }

    function imprimir() {
      const operador = document.getElementById("operador").value;
      const placas = document.getElementById("placas").value;
      const unidad = document.getElementById("unidad").value;
      const transportista = document.getElementById("transportista").value;
      const factura = document.getElementById("factura").value;

      document.getElementById("infoFormulario").innerHTML = `
        <p><strong>Operador:</strong> ${operador}<br>
        <strong>Placas:</strong> ${placas}<br>
        <strong>Unidad:</strong> ${unidad}<br>
        <strong>Transportista:</strong> ${transportista}<br>
        <strong>Factura/Remisión:</strong> ${factura}</p>
      `;

      document.getElementById("nombreOperador").textContent = operador;

      html2pdf().set({ filename: 'reporte_embarque.pdf' }).from(document.getElementById("reporte")).save();
    }
  </script></body>
</html>